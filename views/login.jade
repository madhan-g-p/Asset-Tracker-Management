extends layout

block content
  .row.justify-content-center
    .col-md-6
      h2.text-center.mb-4 Login to Asset Tracker
      form#loginForm(method="post", action="/auth/api/login")
        .form-group
          label(for="username") Username
          input#username.form-control(type='text', name='username', required, autofocus)
        .form-group
          label(for="password") Password
          input#password.form-control(type='password', name='password', required)
        button.btn.btn-primary.btn-block(type='submit') Login
      if error
        .alert.alert-danger.mt-3 #{error}
  script.
    $('#loginForm').on('submit', function(e) {
      e.preventDefault();
      var username = $('#username').val();
      var password = $('#password').val();
      $.ajax({
        url: '/auth/api/login',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({ username, password }),
        success: function(data) {
          // Save token to localStorage for AJAX
          localStorage.setItem('token', data.token);
          // Redirect to home (or employees)
          window.location = '/employees';
        },
        error: function(xhr) {
          $('.alert').remove();
          $('#loginForm').after('<div class="alert alert-danger mt-3">Login failed: ' + (xhr.responseJSON?.error || 'Unknown') + '</div>');
        }
      });
    });